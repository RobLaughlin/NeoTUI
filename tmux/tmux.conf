# ============================================================
# NeoTUI - tmux configuration
# ============================================================

# ─── General ─────────────────────────────────────────────────
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"    # True color support
set -g default-shell "/bin/sh"               # Fallback; overridden below
run-shell "command -v zsh >/dev/null && tmux set-option -g default-shell \"$(command -v zsh)\" || true"
set -g mouse on
set -g base-index 1                          # Windows start at 1
setw -g pane-base-index 1                    # Panes start at 1
set -g renumber-windows on                   # Re-number on close
set -g history-limit 50000
set -g escape-time 10                        # 10ms — enough to catch terminal escape sequences, imperceptible for vi-mode
set -g focus-events on
set -g set-clipboard on

# ─── Vi Mode ─────────────────────────────────────────────────
setw -g mode-keys vi
set -g status-keys vi

# Copy mode vi keybinds (WSL2 clipboard via clip.exe)
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "clip.exe 2>/dev/null || wl-copy 2>/dev/null || xclip -selection clipboard 2>/dev/null"
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "clip.exe 2>/dev/null || wl-copy 2>/dev/null || xclip -selection clipboard 2>/dev/null"
bind -T copy-mode-vi Escape send-keys -X cancel

# ─── Tab Bar (Status Bar) at Top ─────────────────────────────
set -g status-position top
set -g status-interval 5
set -g status-justify left
set -g status-style 'bg=#1e1e2e,fg=#cdd6f4'

# Left: session name
set -g status-left-length 30
set -g status-left '#[bg=#89b4fa,fg=#1e1e2e,bold]  #S #[bg=#1e1e2e,fg=#89b4fa] '

# Right: time & hostname
set -g status-right-length 60
set -g status-right '#[fg=#585b70]│ #[fg=#a6adc8]%Y-%m-%d #[fg=#585b70]│ #[fg=#cdd6f4,bold]%H:%M #[fg=#585b70]│ #[fg=#89b4fa]#h '

# Window (tab) format - inactive
set -g window-status-format '#[fg=#585b70]  #I #W  '

# Window (tab) format - active
set -g window-status-current-format '#[fg=#89b4fa,bg=#313244,bold]  #I #W  #[bg=#1e1e2e,fg=#313244]'

# Window separator
set -g window-status-separator ''

# ─── Pane Styling ────────────────────────────────────────────
set -g pane-border-style 'fg=#313244'
set -g pane-active-border-style 'fg=#89b4fa'

# Message styling
set -g message-style 'bg=#313244,fg=#cdd6f4'
set -g message-command-style 'bg=#313244,fg=#cdd6f4'

# ─── Key Bindings ────────────────────────────────────────────

# Toggle tab bar visibility (prefix + T)
bind T set -g status

# Toggle file explorer sidebar (prefix + E)
bind E run-shell 'neotui-toggle-sidebar'

# Open neovim in current directory (prefix + v)
bind v send-keys 'nvim .' Enter

# Open opencode in a horizontal split below the current pane (prefix + O)
bind O split-window -v -c "#{pane_current_path}" 'opencode || zsh'

# Open claude code in a horizontal split below the current pane (prefix + C)
bind C split-window -v -c "#{pane_current_path}" 'claude || zsh'

# Vi-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane resizing with repeatable binds
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Intuitive split binds (in current directory)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# New window with lf sidebar (uses saved width)
bind c run-shell 'neotui-new-window'

# Quick window switching
bind -r n next-window
bind -r p previous-window

# Reload config
bind r source-file ~/.tmux.conf \; display-message "  Config reloaded"

# ─── Activity ────────────────────────────────────────────────
setw -g monitor-activity off
set -g visual-activity off
